<% layout("layouts/boilerplate.ejs") %>

<div class="container my-4" style="max-width: 900px;">
  <!-- Header -->
  <nav class="navbar navbar-light bg-white shadow-sm rounded-3 px-4 mb-4 dashbar">
    <a class="navbar-brand fw-bold" style="color: rgb(231, 190, 94);"  href="#">Dashboard</a>
    <div class="ms-auto d-flex align-items-center gap-3">
      <% if (currUser && currUser.role === "donar") { %>
      <a href="/donate/<%= donar.id %>/lists"><button class="btn btn-outline-success">My Donations</button></a>
      <% } %>

      <% if (currUser && currUser.role === "volunteer") { %>
      <a href="/listings"><button class="btn btn-outline-success">All Donations</button></a>
      <% } %>

      <button class="btn btn-outline-secondary position-relative">
        ðŸ””
        <% if (notifications && notifications.length > 0) { %>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            <%= notifications.filter(n => !n.isRead).length %>
          </span>
        <% } %>
      </button>

    </div>
  </nav>



  <!-- Welcome -->
  <div class="shadow-sm rounded-3 custom-box thanks">
    <h5 class="mb-1">Hi <%=donar.username %>! ðŸ‘‹</h5>
    <p class="mb-0 small">Thanks for your generous donations! ðŸŒ±</p>
  </div>

  <!-- Quick Stats -->
  <div class="row g-4 my-3">
    <div class="col-md-6">
      <div class="custom-box text-center">
        <p class="text-muted small mb-1 fw-bold">Meals Donated</p>
        <h3 class="fw-bold text-success fw-bold"><%= totalMeals %></h3>
      </div>
    </div>
    <div class="col-md-6">
      <div class="custom-box text-center">
        <p class="text-muted small mb-1 fw-bold">COâ‚‚ Saved</p>
        <h3 class="fw-bold text-success fw-bold"><%= totalCO2.toFixed(1) %> kg</h3>
      </div>
    </div>
  </div>
     
    <% if (currUser && currUser.role === "donar") { %>
  <div class="addList">
    <a href="/donate/<%= donar.id %>">
      <button class="btn btn-outline-success listbtn">
        <i class="fa-solid fa-bowl-food"></i>&nbsp; &nbsp;List food
      </button>
    </a>
  </div>
  <% } %>

  <!-- Recent Donations -->
<!-- Recent Donations -->
<div class="custom-box">
  <% if (currUser && currUser.role === "donar") { %>
    <div class="fw-bold fw-semibold p-2 rounded-top">
      Recent Donations
    </div>
    <% if (donorListings.length === 0) { %>
      <p class="text-muted small p-3">No donations yet. List your first food donation! ðŸŒ±</p>
    <% } else { %>
      <ul class="list-group list-group-flush">
        <% donorListings.forEach(listing => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong><%= listing.food %></strong>
              <br>
              <small class="text-muted"><%= listing.location %></small>
            </div>
            <div>
              <% if (listing.status === "Available") { %>
                <span class="badge bg-success">Available</span>
              <% } else if (listing.status === "Picked Up") { %>
                <span class="badge bg-warning text-dark">Picked Up</span>
              <% } else { %>
                <span class="badge bg-secondary">Expired</span>
              <% } %>
            </div>
          </li>
        <% }) %>
      </ul>
    <% } %>
  <% } else if (currUser && currUser.role === "volunteer") { %>
    <div class="fw-bold fw-semibold p-2 rounded-top">
      Notifications
    </div>
    <% if (notifications.length === 0) { %>
      <p class="text-muted small p-3">No notifications yet. Check back later! ðŸ””</p>
    <% } else { %>
      <ul class="list-group list-group-flush">
        <% notifications.forEach(note => { %>
          <li class="list-group-item">
            <%= note.message %>
            <br>
            <small class="text-muted"><%= note.createdAt.toDateString() %></small>
          </li>
        <% }) %>
      </ul>
    <% } %>
  <% } %>
</div>

